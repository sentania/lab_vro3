<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="tenantNametoCafeHost" result-type="vCACCAFE:VCACHost" api-version="6.0.0" id="000b5918-9b21-4a0a-9745-bf7af3187ea5" version="0.0.9" allowed-operations="evf" category-name="com.sovlabs.vra.utilities">
  <param n="tenantName" t="string"/>
  <script encoded="false"><![CDATA[var origHosts = Server.findAllForType("vCACCAFE:VCACHost",null);

// Filter vCACCAFE hosts to include only hosts in "Shared Session" mode, and for vsphere.lcoal the sovlabs endpoints.
var cafeHosts = new Array();
for each (var cafeHost in origHosts) {
	if ( cafeHost.sessionMode == "Shared Session") {
		if (cafeHost.tenant.match("vsphere.local", "i")) {
			if (cafeHost.name.match("^sovlabs", "i")) {
				cafeHosts.push(cafeHost);
			}
		} else {
			cafeHosts.push(cafeHost);
		}
	}
}

if ( cafeHosts.length > 0 ) {
	if ( tenantName == undefined || tenantName == null )  {
	  // no TenantName, just ruturn the first Host. 
	  return cafeHosts[0];
	}
	
	for each (var cafeHost in cafeHosts) {
		//System.log("HOST: " + hosts[x].toSource());
		var tenant = cafeHost.tenant;
		if ( tenant == tenantName ) {
			return cafeHost;
		}
	}
	
	throw ("Unable to find vCACCafe Host for tenant " +tenantName + " please ensure that the vCACCafe Host has been properly configured");
} else {
	throw ("No VCACCAFE:VCACHost found.  Please ensure that a vCACCAfe host has been propertly configured.");
}


]]></script>
</dunes-script-module>