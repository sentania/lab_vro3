<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="provisionigIdtoTenantName" result-type="string" api-version="6.0.0" id="91e8623b-2415-4e57-a64e-ba07e1078544" version="0.0.10" allowed-operations="evf" category-name="com.sovlabs.vra.utilities">
  <param n="provisioningId" t="string"/>
  <script encoded="false"><![CDATA[origHosts = Server.findAllForType("vCACCAFE:vCACHost", null);

if (origHosts.length > 0) {
	
	// Filter vCACCAFE host array to include only hosts with "Shared Session" mode and sovlabs endpoints
	var cafeHosts = new Array();
	for each (var cafeHost in origHosts) {
		if(cafeHost.sessionMode == "Shared Session") {
			if(cafeHost.tenant.match("vsphere.local", "i")) {
				if (cafeHost.name.match("^sovlabs", "i")) {
					cafeHosts.push(cafeHost);
				}
			} else {
				cafeHosts.push(cafeHost);
			}
		}
	}
	
	// Get the business group of a cafehost
	for each (var cafeHost in cafeHosts) {
		try {
	    	var bg = vCACCAFEEntitiesFinder.getBusinessGroup(cafeHost, provisioningId);
	    } catch (err) {
	    	continue;
		}
		if (bg != null) {
	    	return cafeHost.tenant;
	    }
	}
    throw ("Unable to find vCACCAFE Host for provisioning group of " + provisioningId + " please ensure that the vCACCafe Host has been properly configured");
} else {
    throw ("No VCACCAFeHosts found.  Please ensure that a vRA and vRO host has been propertly configured.");
}
]]></script>
</dunes-script-module>