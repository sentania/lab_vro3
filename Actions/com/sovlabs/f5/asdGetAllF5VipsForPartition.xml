<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="asdGetAllF5VipsForPartition" result-type="Array/string" api-version="6.0.0" id="dd20255a-a51e-4653-a626-c35423b4b8e2" version="0.0.4" allowed-operations="evf" category-name="com.sovlabs.f5">
  <param n="f5EndpointName" t="string"/>
  <param n="tenant" t="string"/>
  <param n="partition" t="string"/>
  <script encoded="false"><![CDATA[var retArray = [];

var restipe = "---\n"+
        "restipeName: SovLabs F5 Utilities\n" +
        "description: SovLabs F5 Utilities - Get F5 VIPs for Partition\n" +
        "debugLogging: true\n" +
        "user: \"{{restipe.host.user}}\"\n" +
        "password: \"{{restipe.host.password}}\"\n" +
        "useBasicAuth: true\n" +
        "baseurl: \"{{restipe.host.protocol}}://{{restipe.host.hostname}}:{{restipe.host.port}}/mgmt/tm\"\n" +
		"#########################\n" +
		"#  Start the steps Here\n" +
		"#########################\n" +
        "steps:\n"+
        "  getVirtuals:\n" +
        "    description: Get the list of Virtuals based on Partition\n" +
        "    url: \"{{restipe.baseurl}}/ltm/virtual\"\n" +
        "    method: get\n" +
        "    nextStep: \"{% if restipe.getVirtuals.status == 200%}SUCCESS{% else %}FAILURE{% endif %}\"";

try {
	if (f5EndpointName !== null && tenant !== null && partition !== null) {
		var response = sovlabsF5Manager.executeRestipeString( f5EndpointName, tenant, "{}", restipe, "getVirtuals");
		ret = JSON.parse(response);
		System.log("Response " + response);
		
		for each ( var item in ret.restipe.getVirtuals.body.items )  {
		  if ( item.partition == partition ) { 
		    retArray.push(item.name);
		  }
		}
	}
} catch (e) {

}
return retArray;
]]></script>
</dunes-script-module>