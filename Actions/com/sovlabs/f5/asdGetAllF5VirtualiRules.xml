<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="asdGetAllF5VirtualiRules" result-type="Array/string" api-version="6.0.0" id="7a95eaf4-bbf4-428e-9a97-aa7566366831" version="0.0.0" allowed-operations="evf" category-name="com.sovlabs.f5">
  <param n="tenant" t="string"/>
  <param n="f5EndpointName" t="string"/>
  <param n="partition" t="string"/>
  <script encoded="false"><![CDATA[var retArray = [];

var restipe = "---\n"+
        "restipeName: SovLabs F5 Utilities\n"+
        "description: SovLabs F5 Utilities - Get Virtual iRules\n"+
        "debugLogging: true\n"+
        "user: \"{{restipe.host.user}}\"\n"+
        "password: \"{{restipe.host.password}}\"\n"+
        "useBasicAuth: true\n"+
        "baseurl: \"{{restipe.host.protocol}}://{{restipe.host.hostname}}:{{restipe.host.port}}/mgmt/tm\"\n"+
		"#########################\n"+
		"#  Start the steps Here\n"+
		"#########################\n"+
        "steps:\n"+
        "  getVirtualiRules:\n"+
        "    description: Get the list of iRules for Virtual Servers\n"+
        "    url: \"{{restipe.baseurl}}/ltm/rule\"\n"+
        "    method: get\n"+
        "    nextStep: \"{% if restipe.getVirtualiRules.status == 200%}SUCCESS{% else %}FAILURE{% endif %}\"";

try {
	if (tenant !== null && f5EndpointName !== null && partition !== null) {
		var response = sovlabsF5Manager.executeRestipeString(f5EndpointName , tenant , "{}" , restipe , "getVirtualiRules");
		var ret = JSON.parse(response);
		
		for each ( var item in ret.restipe.getVirtualiRules.body.items )  {
		  if ( item.partition == partition ) { 
		    retArray.push(item.name);
		  }
		}
	}
} catch (e) {

}

return retArray;]]></script>
</dunes-script-module>