<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="getReservationTypeIdForComponent_Fixed" result-type="void" api-version="6.0.0" id="3570c6d7-c348-44cb-bdb9-cbdbd5459007" version="1.0.0" allowed-operations="evf" category-name="com.nm.ucp">
  <param n="host" t="vCACCAFE:VCACHost"/>
  <param n="blueprintId" t="string"/>
  <param n="componentId" t="string"/>
  <script encoded="false"><![CDATA[var compositionService = host.createCompositionClient().getCompositionCompositeBlueprintService();
System.log(compositionService);


var blueprint = compositionService.getBlueprint(blueprintId);
var component = blueprint.getComponents().get(componentId);

System.log("blueprint = "+blueprint);
System.log("component = "+component);

if  (component != null) {
	var configurationElementCategory = Server.getConfigurationElementCategoryWithPath("System/vRealize Automation/XaaS/Resource Mappings/vCenter");
	for each(var configElem in configurationElementCategory.configurationElements) {
		if(configElem.name == "ReservationMappingConfigurationElement") {
			var reservationProps = configElem.getAttributeWithKey("ComponentTypeToReservationTypeMapper");
			var match = reservationProps.value.get(component.getType());
			if (match == null) {
				System.log("No matching reservation type for the type '" + component.getType() + "' for component '" + componentId + "' of blueprint '" + blueprintId + "' has been found.");
			}
			return match;
		}
	}
}
System.warn("The selected component '" + componentId + "' of blueprint '" + blueprintId + "' is null");
return null;]]></script>
</dunes-script-module>