<?xml version='1.0' encoding='UTF-8'?>
<dunes-script-module name="getUtanValue" result-type="Array/string" api-version="6.0.0" id="ae8e0298-1a8d-470f-9917-24ce10546e18" version="0.0.0" allowed-operations="vfe" category-name="com.nm.ucp">
  <param n="utan" t="string"><![CDATA[UTAN to Search for]]></param>
  <script encoded="false"><![CDATA[//Get etcd "get" Rest Operation
var getHosts = Server.findAllForType("REST:RESTOperation")
for(var i =0; i < getHosts.length ; i++){
	if(getHosts[i].name == "Unified Compute etcd GET"){
		var restOp = getHosts[i]
			System.log("Name - " + restOp.name)
		}
}
if(utan != null){
	var returnValue = [];
	if(utan.length > 4){
		//Set etcd key path
		//content = "unifiedcompute/servers/" + utan + "/environment"
		content = "externalData/iAmpData/" + utan + "/name"
		var inParamtersValues = [content];
		var request = restOp.createRequest(inParamtersValues);
		
		//set the request content type
		request.contentType = "application\/json";
		System.log("Request: " + request);
		System.log("Request URL: " + request.fullUrl);
		
		var response = request.execute();
		
		//prepare output parameters
		System.log("Response: " + response);
		statusCode = response.statusCode;
		statusCodeAttribute = statusCode;
		System.log("Status code: " + statusCode);
		contentLength = response.contentLength;
		headers = response.getAllHeaders();
		contentAsString = response.contentAsString;
		System.log("Content as string: " + contentAsString);
		var keyValue = JSON.parse(contentAsString);
		if(statusCode == '200'){
			System.log("Key Value = " + keyValue.node.value);
			var returnValue = [];
			returnValue.push(keyValue.node.value);
			return returnValue
		}
		else{
			var empty = "Please enter a valid UTAN above.";
			var returnValue = [];
			returnValue.push(empty);
			return returnValue;
		}
		
	} else {
		var empty = "Please enter a valid UTAN above.";
		var returnValue = [];
		returnValue.push(empty);
		return returnValue;
	}
}]]></script>
</dunes-script-module>