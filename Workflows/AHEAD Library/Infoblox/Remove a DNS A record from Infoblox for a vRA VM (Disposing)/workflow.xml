<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="40af6262-5839-4392-bb90-eac0f61dd0ae" version="1.0.0" api-version="6.0.0" allowed-operations="evf" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[Remove a DNS A record from Infoblox for a vRA VM (Disposing)]]></display-name>
  <description><![CDATA[Looks for a vRA Custom Property called  'AheadInfoblox.HostRecord' which contains the FQDN of the host record to remove.

If the Custom Property is not present, the workflow skips removing the DNS record.  
To prevent this Custom Property's creation during provisioning (perhaps after implementing the official Infoblox Plug-In), 
see the Description field of workflow 'Create a DNS A record in Infoblox for a vRA VM (BuildingMachine)'.]]></description>
  <position y="50.0" x="100.0"/>
  <input>
    <param name="customProperties" type="Properties">
      <description><![CDATA[vRA Custom Properties of the target VM]]></description>
    </param>
  </input>
  <attrib name="restHost" type="REST:RESTHost" read-only="true" conf-id="49ee40b8-06c5-40c5-9b9b-fd0861407450" conf-key="restHost">
    <value encoded="n"><![CDATA[dunes://service.dunes.ch/CustomSDKObject?id='a4349959-c772-46f0-90e1-c9fd0b9fbe53'&dunesName='REST:RESTHost']]></value>
    <description><![CDATA[The Infoblox REST host that should take the request.]]></description>
  </attrib>
  <attrib name="hostRecordFqdn" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[Host record FQDN, which is read from a custom prop]]></description>
  </attrib>
  <attrib name="hostReferenceId" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[Reference ID of the host record to delete]]></description>
  </attrib>
  <workflow-item name="item0" type="end" end-mode="0">
    <position y="45.40909090909091" x="804.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item2" type="task">
    <display-name><![CDATA[Get Host Record]]></display-name>
    <script encoded="false"><![CDATA[hostRecordFqdn = customProperties.get("AheadInfoblox.HostRecord");
]]></script>
    <in-binding>
      <bind name="customProperties" type="Properties" export-name="customProperties">
        <description><![CDATA[vRA Custom Properties of the target VM]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="hostRecordFqdn" type="string" export-name="hostRecordFqdn">
        <description><![CDATA[Host record FQDN, which is read from a custom prop]]></description>
      </bind>
    </out-binding>
    <description><![CDATA[Read the host record's FQDN from a vRA Custom Property]]></description>
    <position y="55.40909090909091" x="204.5"/>
  </workflow-item>
  <workflow-item name="item2" out-name="item5" type="custom-condition" alt-out-name="item4">
    <display-name><![CDATA[Record Present?]]></display-name>
    <script encoded="false"><![CDATA[//if hostRecordFqdn is falsy, then the Custom Property wasn't present
if (hostRecordFqdn) return true;
return false;]]></script>
    <in-binding>
      <bind name="hostRecordFqdn" type="string" export-name="hostRecordFqdn"/>
    </in-binding>
    <description><![CDATA[If the vRA Custom Property with the host record wasn't present, then end the workflow.]]></description>
    <position y="45.90909090909091" x="345.0"/>
  </workflow-item>
  <workflow-item name="item3" type="end" end-mode="0">
    <position y="172.68181818181816" x="385.0"/>
  </workflow-item>
  <workflow-item name="item4" prototype-id="system-warning" out-name="item3" type="task" interaction="l">
    <display-name><![CDATA[Log a Warning]]></display-name>
    <script encoded="false"><![CDATA[var message = "vRA Custom Property 'AheadInfoblox.HostRecord' was not found. "
			+ "Skipping DNS record removal via Ahead's '" + workflow.currentWorkflow.name + "' workflow. "
			+ "This could be intentional, if the official Infoblox plug-in is now installed.";

System.warn(message);]]></script>
    <in-binding/>
    <out-binding/>
    <description><![CDATA[Log the fact that the Custom Property wasn't present, and a DNS record isn't being removed.]]></description>
    <position y="119.04545454545453" x="345.0"/>
  </workflow-item>
  <workflow-item name="item5" out-name="item7" type="link" linked-workflow-id="692f6ff9-44eb-4933-baac-39a82efaadcf">
    <display-name><![CDATA[Get the Reference ID for an Infoblox Host Record]]></display-name>
    <in-binding>
      <bind name="restHost" type="REST:RESTHost" export-name="restHost">
        <description><![CDATA[The Infoblox REST host that should take the request.]]></description>
      </bind>
      <bind name="hostFqdn" type="string" export-name="hostRecordFqdn">
        <description><![CDATA[Fully Qualified Domain Name of the host record to find]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="hostReferenceId" type="string" export-name="hostReferenceId">
        <description><![CDATA[Infoblox Reference ID of the host record]]></description>
      </bind>
    </out-binding>
    <position y="55.40909090909091" x="484.5"/>
  </workflow-item>
  <workflow-item name="item7" out-name="item0" type="link" linked-workflow-id="5c6d7e47-1ebb-4667-8eb3-c4e828f98801">
    <display-name><![CDATA[Remove a DNS A record from Infoblox]]></display-name>
    <in-binding>
      <bind name="restHost" type="REST:RESTHost" export-name="restHost">
        <description><![CDATA[The Infoblox REST host that should take the request.]]></description>
      </bind>
      <bind name="hostReferenceId" type="string" export-name="hostReferenceId">
        <description><![CDATA[Reference ID of the host record to delete]]></description>
      </bind>
    </in-binding>
    <out-binding/>
    <description><![CDATA[Deletes the host record (aka A record), as specified by its Reference ID, from Inboblox]]></description>
    <position y="55.40909090909091" x="624.5"/>
  </workflow-item>
  <presentation>
    <p-param name="customProperties">
      <desc><![CDATA[vRA Custom Properties of the target VM]]></desc>
    </p-param>
  </presentation>
</workflow>