<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item2" object-name="workflow:name=generic" id="01a7845e-95b0-4794-a3d3-c672f3d589cb" version="1.0.1" api-version="6.0.0" allowed-operations="evf" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[Associate_Create a VM Tag_Category from Properties]]></display-name>
  <description><![CDATA[The input Properties object contains info about a Tag to associate with the input VM. If the tag doesn't exist it will be created.

The purpose of this workflow accepting the tag info as a Properties is so that it can be easily called from vRO's "foreach" canvas 
element to create multiple tags.  The "foreach" should be fed by an array of Properties.

Expected keys for the input properties: 
tagName, tagDescription (optional), categoryName, categoryDescription (optional), categoryMultipleCardinality: true/false (optional)

OPTIONS - see Configuration Element  'vCenter Tagging' to change:
* Missing tag categories can be created (instead of throwing an error).]]></description>
  <position y="50.0" x="100.0"/>
  <input>
    <param name="vcVm" type="VC:VirtualMachine">
      <description><![CDATA[vCenter VM to which the tag will be associated]]></description>
    </param>
    <param name="tagProperties" type="Properties">
      <description><![CDATA[Expected keys: tagName, tagDescription (optional), categoryName, categoryDescription (optional), categoryMultipleCardinality (optional: true/false)]]></description>
    </param>
  </input>
  <attrib name="tagName" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[Name for the new tag]]></description>
  </attrib>
  <attrib name="tagDescription" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[Optional. Description for the new tag]]></description>
  </attrib>
  <attrib name="categoryName" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[the name of the Tag Category to look for]]></description>
  </attrib>
  <attrib name="categoryDescription" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[Optional. Description for the new tag category]]></description>
  </attrib>
  <attrib name="categoryMultipleCardinality" type="boolean" read-only="false">
    <description><![CDATA[true = multiple, false = single (default)]]></description>
  </attrib>
  <workflow-item name="item0" type="end" end-mode="0">
    <position y="45.40909090909091" x="524.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item0" type="link" linked-workflow-id="b4da11bd-8b5f-462d-9309-157d95b63fa4">
    <display-name><![CDATA[Associate/Create a VM Tag/Category]]></display-name>
    <in-binding>
      <bind name="vcVm" type="VC:VirtualMachine" export-name="vcVm">
        <description><![CDATA[vCenter VM to which the tag will be associated]]></description>
      </bind>
      <bind name="tagName" type="string" export-name="tagName">
        <description><![CDATA[Name for the new tag]]></description>
      </bind>
      <bind name="tagDescription" type="string" export-name="tagDescription">
        <description><![CDATA[Optional. Description for the new tag]]></description>
      </bind>
      <bind name="categoryName" type="string" export-name="categoryName">
        <description><![CDATA[the name of the Tag Category to look for]]></description>
      </bind>
      <bind name="categoryDescription" type="string" export-name="categoryDescription">
        <description><![CDATA[Optional. Description for the new tag category]]></description>
      </bind>
      <bind name="categoryMultipleCardinality" type="boolean" export-name="categoryMultipleCardinality">
        <description><![CDATA[true = multiple, false = single (default)]]></description>
      </bind>
    </in-binding>
    <out-binding/>
    <description><![CDATA[Specify a tag name and VM.
If the tag exists it gets associated with the VM.
If the tag doesn't exist it gets created.
If the tag's category (required) doesn't exist, there is an option to create it.]]></description>
    <position y="55.40909090909091" x="344.5"/>
  </workflow-item>
  <workflow-item name="item2" out-name="item1" type="task">
    <display-name><![CDATA[Read Properties]]></display-name>
    <script encoded="false"><![CDATA[tagName = tagProperties.get("tagName");
tagDescription = tagProperties.get("tagDescription");
categoryName = tagProperties.get("categoryName");
categoryDescription = tagProperties.get("categoryDescription");

//determine cardinality
categoryMultipleCardinality = false;  //default, if not specified, is single cardinality
var multiCardStr = tagProperties.get("categoryMultipleCardinality");
if (multiCardStr && typeof(multiCardStr) == "string" && multiCardStr.toLowerCase() == "true") {
	categoryMultipleCardinality = true;
}
]]></script>
    <in-binding>
      <bind name="tagProperties" type="Properties" export-name="tagProperties"/>
    </in-binding>
    <out-binding>
      <bind name="tagName" type="string" export-name="tagName">
        <description><![CDATA[Name for the new tag]]></description>
      </bind>
      <bind name="tagDescription" type="string" export-name="tagDescription">
        <description><![CDATA[Optional. Description for the new tag]]></description>
      </bind>
      <bind name="categoryName" type="string" export-name="categoryName">
        <description><![CDATA[the name of the Tag Category to look for]]></description>
      </bind>
      <bind name="categoryDescription" type="string" export-name="categoryDescription">
        <description><![CDATA[Optional. Description for the new tag category]]></description>
      </bind>
      <bind name="categoryMultipleCardinality" type="boolean" export-name="categoryMultipleCardinality">
        <description><![CDATA[true = multiple, false = single (default)]]></description>
      </bind>
    </out-binding>
    <position y="55.40909090909091" x="204.5"/>
  </workflow-item>
  <presentation>
    <p-param name="vcVm">
      <desc><![CDATA[vCenter VM to which the tag will be associated]]></desc>
    </p-param>
    <p-param name="tagProperties">
      <desc><![CDATA[Expected keys: tagName, tagDescription (optional), categoryName, categoryDescription (optional), categoryMultipleCardinality (optional: true/false)]]></desc>
    </p-param>
  </presentation>
</workflow>