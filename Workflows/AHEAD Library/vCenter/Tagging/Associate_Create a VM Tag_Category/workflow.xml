<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item9" object-name="workflow:name=generic" id="b4da11bd-8b5f-462d-9309-157d95b63fa4" version="1.1.0" api-version="6.0.0" allowed-operations="evf" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[Associate_Create a VM Tag_Category]]></display-name>
  <description><![CDATA[Associates the specifed Tag with the specified VM. If the tag doesn't exist it will be created.

OPTIONS - see Configuration Element  'vCenter Tagging' to change:
* Missing tag categories can be created (instead of throwing an error).]]></description>
  <position y="50.0" x="100.0"/>
  <input>
    <param name="vcVm" type="VC:VirtualMachine">
      <description><![CDATA[vCenter VM to which the tag will be associated]]></description>
    </param>
    <param name="tagName" type="string">
      <description><![CDATA[Name for the new tag]]></description>
    </param>
    <param name="tagDescription" type="string">
      <description><![CDATA[Optional. Description for the new tag]]></description>
    </param>
    <param name="categoryName" type="string">
      <description><![CDATA[the name of the Tag Category to look for]]></description>
    </param>
    <param name="categoryDescription" type="string">
      <description><![CDATA[Optional. Description for the new tag category]]></description>
    </param>
    <param name="categoryMultipleCardinality" type="boolean">
      <description><![CDATA[true = multiple, false = single (default)]]></description>
    </param>
  </input>
  <attrib name="vapiEndpoint" type="VAPI:VAPIEndpoint" read-only="false">
    <description><![CDATA[The vAPI Endpoint to connect to]]></description>
  </attrib>
  <attrib name="categoryId" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[ID of the tag category to which the new tag will belong]]></description>
  </attrib>
  <attrib name="tagId" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
    <description><![CDATA[The ID of the newly created tag]]></description>
  </attrib>
  <attrib name="errorCode" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="categoryCreateIfNeeded" type="boolean" read-only="true" conf-id="fbf0c5eb-681b-4820-bdd5-e8ce7b07e9fa" conf-key="createTagCategoryIfNeeded">
    <value encoded="n"><![CDATA[false]]></value>
    <description><![CDATA[OK to create the category if it doesn't already exist?]]></description>
  </attrib>
  <attrib name="categoryEntityTypes" type="Array/string" read-only="true" conf-id="fbf0c5eb-681b-4820-bdd5-e8ce7b07e9fa" conf-key="categoryEntityTypes">
    <value encoded="n"><![CDATA[__NULL__]]></value>
    <description><![CDATA[Null = all types. Known allowable types: ClusterComputeResource, Datacenter, Datastore, StoragePod, DistributedVirtualPortgroup, VmwareDistributedVirtualSwitch, Folder, ResourcePool, Network, VirtualMachine, HostSystem]]></description>
  </attrib>
  <workflow-note x="620.0" y="170.72727272727272" w="260.0" h="97.0">
    <description><![CDATA[Create Tag Category]]></description>
  </workflow-note>
  <workflow-note x="620.0" y="98.0" w="260.0" h="69.0">
    <description><![CDATA[Create Tag]]></description>
  </workflow-note>
  <workflow-item name="item0" out-name="item7" type="link" linked-workflow-id="65539eeb-f230-4393-a490-e44e952a213c">
    <display-name><![CDATA[Create Tag]]></display-name>
    <in-binding>
      <bind name="vapiEndpoint" type="VAPI:VAPIEndpoint" export-name="vapiEndpoint">
        <description><![CDATA[The vAPI Endpoint to connect to]]></description>
      </bind>
      <bind name="categoryId" type="string" export-name="categoryId">
        <description><![CDATA[ID of the tag category to which the new tag will belong]]></description>
      </bind>
      <bind name="description" type="string" export-name="tagDescription">
        <description><![CDATA[Optional. Description for the new tag]]></description>
      </bind>
      <bind name="tagName" type="string" export-name="tagName">
        <description><![CDATA[Name for the new tag]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="tagId" type="string" export-name="tagId">
        <description><![CDATA[The ID of the newly created tag]]></description>
      </bind>
    </out-binding>
    <description><![CDATA[Updated version of the VAPI plug-in' s "Create tag" workflow.  This version outputs the tag ID of the new tag.]]></description>
    <position y="119.04545454545453" x="764.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item7" type="custom-condition" alt-out-name="item3">
    <display-name><![CDATA[Tag Exists?]]></display-name>
    <script encoded="false"><![CDATA[//if tagId is not null, then it must exist
if (tagId) {
	System.log("Found existing tag with ID '" + tagId + "'. Skipping creation of new tag.");
	return true;
}
return false;]]></script>
    <in-binding>
      <bind name="tagId" type="string" export-name="tagId"/>
    </in-binding>
    <position y="45.40909090909091" x="764.5"/>
  </workflow-item>
  <workflow-item name="item2" out-name="item10" type="task" script-module="com.thinkahead.vapi/getVapiEndpointForVcVm">
    <display-name><![CDATA[Get vAPI Endpoint]]></display-name>
    <script encoded="false"><![CDATA[//Auto generated script, cannot be modified !
actionResult = System.getModule("com.thinkahead.vapi").getVapiEndpointForVcVm(vcVm) ;]]></script>
    <in-binding>
      <bind name="vcVm" type="VC:VirtualMachine" export-name="vcVm">
        <description><![CDATA[the vCenter VM for which to find a vAPI Endpoirnt ]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="actionResult" type="VAPI:VAPIEndpoint" export-name="vapiEndpoint"/>
    </out-binding>
    <description><![CDATA[Returns the vAPI Endpoint that matches the vCenter SDK Connection of the specified VM.

NOTE: only matches short hostname, since FQDN might not have been used for both the 
Endpoint and the SDK Connection.]]></description>
    <position y="55.40909090909091" x="344.5"/>
  </workflow-item>
  <workflow-item name="item3" out-name="item0" type="custom-condition" alt-out-name="item8">
    <display-name><![CDATA[Category Exists?]]></display-name>
    <script encoded="false"><![CDATA[//If the categoryId is not null, then the category must exist
if (categoryId) {
	System.log("Found existing tag category with ID '" + categoryId + "'.");
	return true;
} else {
	System.log("Tag category does not exist.");
	return false;
}]]></script>
    <in-binding>
      <bind name="categoryId" type="string" export-name="categoryId"/>
    </in-binding>
    <position y="109.04545454545453" x="624.5"/>
  </workflow-item>
  <workflow-item name="item4" throw-bind-name="errorCode" type="end" end-mode="1">
    <position y="218.13636363636363" x="804.5"/>
  </workflow-item>
  <workflow-item name="item5" out-name="item4" type="task">
    <display-name><![CDATA[Set Error]]></display-name>
    <script encoded="false"><![CDATA[errorCode = "Tag category '" + categoryName + "' does not exist in the vCenter with VAPI Endpoint '" + vapiEndpoint.name + "'.";]]></script>
    <in-binding>
      <bind name="categoryName" type="string" export-name="categoryName">
        <description><![CDATA[the name of the Tag Category to look for]]></description>
      </bind>
      <bind name="vapiEndpoint" type="VAPI:VAPIEndpoint" export-name="vapiEndpoint">
        <description><![CDATA[The vAPI Endpoint to connect to]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="errorCode" type="string" export-name="errorCode"/>
    </out-binding>
    <position y="228.13636363636363" x="624.5"/>
  </workflow-item>
  <workflow-item name="item6" out-name="item0" type="link" linked-workflow-id="b0dff549-a396-42a0-b0f9-fb085ceb529f">
    <display-name><![CDATA[Create Category]]></display-name>
    <in-binding>
      <bind name="vapiEndpoint" type="VAPI:VAPIEndpoint" export-name="vapiEndpoint">
        <description><![CDATA[The vAPI Endpoint to connect to]]></description>
      </bind>
      <bind name="categoryName" type="string" export-name="categoryName">
        <description><![CDATA[Name of the category to be created]]></description>
      </bind>
      <bind name="description" type="string" export-name="categoryDescription">
        <description><![CDATA[Description for the Tag Category]]></description>
      </bind>
      <bind name="entityTypes" type="Array/string" export-name="categoryEntityTypes">
        <description><![CDATA[Null = all types. Known allowable types: ClusterComputeResource, Datacenter, Datastore, StoragePod, DistributedVirtualPortgroup, VmwareDistributedVirtualSwitch, Folder, ResourcePool, Network, VirtualMachine, HostSystem]]></description>
      </bind>
      <bind name="multipleCardinality" type="boolean" export-name="categoryMultipleCardinality">
        <description><![CDATA[False = Single (default), True = Multiple]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="categoryId" type="string" export-name="categoryId"/>
    </out-binding>
    <description><![CDATA[Updated version of "Create tag category" from the VAPI plug-in.  This version validates inputs and returns the ID of the new tag category.

If entityTypes is null, the new Category will apply to All entitiy types.  To figure out the entity type of an object, go to the Inventory tab 
in vRO, and browse to your object in the vCenter plug-in.  Once an object is selected, its Type will be noted in the top-right corner
 of the vRO window.]]></description>
    <position y="182.68181818181816" x="764.5"/>
  </workflow-item>
  <workflow-item name="item7" out-name="item12" type="link" linked-workflow-id="8a7acab9-1c83-49fc-914b-bd07406b825a">
    <display-name><![CDATA[Associate Tag to VM]]></display-name>
    <in-binding>
      <bind name="vcVm" type="VC:VirtualMachine" export-name="vcVm">
        <description><![CDATA[The VM to which the tag should be associated]]></description>
      </bind>
      <bind name="tagId" type="string" export-name="tagId">
        <description><![CDATA[ID of the tag to associate]]></description>
      </bind>
    </in-binding>
    <out-binding/>
    <position y="91.77272727272727" x="944.5"/>
  </workflow-item>
  <workflow-item name="item8" out-name="item6" type="custom-condition" alt-out-name="item5">
    <display-name><![CDATA[Create Category?]]></display-name>
    <script encoded="false"><![CDATA[System.log("Input flag 'categoryCreateIfNeeded' is " + categoryCreateIfNeeded);
return categoryCreateIfNeeded;]]></script>
    <in-binding>
      <bind name="categoryCreateIfNeeded" type="boolean" export-name="categoryCreateIfNeeded"/>
    </in-binding>
    <position y="172.68181818181816" x="624.5"/>
  </workflow-item>
  <workflow-item name="item9" prototype-id="system-log" out-name="item2" type="task" interaction="l">
    <display-name><![CDATA[System log]]></display-name>
    <script encoded="false"><![CDATA[System.log("Running workflow: '" + workflow.currentWorkflow.name + "' for tag '" + tagName + "' and category '" + categoryName + "'.");
]]></script>
    <in-binding>
      <bind name="tagName" type="string" export-name="tagName">
        <description><![CDATA[Name for the new tag]]></description>
      </bind>
      <bind name="categoryName" type="string" export-name="categoryName">
        <description><![CDATA[the name of the Tag Category to look for]]></description>
      </bind>
    </in-binding>
    <out-binding/>
    <description><![CDATA[Log the input text to the console log with level 'log']]></description>
    <position y="55.40909090909091" x="205.0"/>
  </workflow-item>
  <workflow-item name="item10" out-name="item11" type="link" linked-workflow-id="5cb4bb41-b523-4bdc-ac93-294bff44b4a7">
    <display-name><![CDATA[Get Tag Category ID]]></display-name>
    <in-binding>
      <bind name="vapiEndpoint" type="VAPI:VAPIEndpoint" export-name="vapiEndpoint">
        <description><![CDATA[The vAPI Endpoint to connect to]]></description>
      </bind>
      <bind name="categoryName" type="string" export-name="categoryName">
        <description><![CDATA[The name of the category ID to find]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="categoryId" type="string" export-name="categoryId"/>
    </out-binding>
    <position y="55.40909090909091" x="484.5"/>
  </workflow-item>
  <workflow-item name="item11" out-name="item1" type="link" linked-workflow-id="369afed7-8804-4b0b-96e0-4871b2e3c686">
    <display-name><![CDATA[Get Tag ID]]></display-name>
    <in-binding>
      <bind name="vapiEndpoint" type="VAPI:VAPIEndpoint" export-name="vapiEndpoint">
        <description><![CDATA[The vAPI Endpoint to connect to]]></description>
      </bind>
      <bind name="categoryId" type="string" export-name="categoryId">
        <description><![CDATA[The category ID of the tag to find]]></description>
      </bind>
      <bind name="tagValue" type="string" export-name="tagName">
        <description><![CDATA[The tag to find (aka Tag Name or Tag Value)]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="tagId" type="string" export-name="tagId"/>
    </out-binding>
    <position y="55.40909090909091" x="624.5"/>
  </workflow-item>
  <workflow-item name="item12" type="end" end-mode="0">
    <position y="81.77272727272727" x="1125.0"/>
  </workflow-item>
  <presentation>
    <p-param name="vcVm">
      <desc><![CDATA[vCenter VM to which the tag will be associated]]></desc>
    </p-param>
    <p-param name="tagName">
      <desc><![CDATA[Name for the new tag]]></desc>
    </p-param>
    <p-param name="tagDescription">
      <desc><![CDATA[Optional. Description for the new tag]]></desc>
    </p-param>
    <p-param name="categoryName">
      <desc><![CDATA[the name of the Tag Category to look for]]></desc>
    </p-param>
    <p-param name="categoryDescription">
      <desc><![CDATA[Optional. Description for the new tag category]]></desc>
    </p-param>
    <p-param name="categoryMultipleCardinality">
      <desc><![CDATA[true = multiple, false = single (default)]]></desc>
    </p-param>
  </presentation>
</workflow>