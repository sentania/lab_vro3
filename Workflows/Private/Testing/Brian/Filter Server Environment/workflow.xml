<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="f4f117f8-b358-4256-be33-c159ea293100" version="0.0.6" api-version="6.0.0" allowed-operations="evf" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[Filter Server Environment]]></display-name>
  <position y="50.0" x="100.0"/>
  <attrib name="vcacServerOut" type="Array/vCAC:VirtualMachine" read-only="false">
    <value encoded="n"><![CDATA[__NULL__]]></value>
  </attrib>
  <attrib name="host" type="vCAC:VCACHost" read-only="false">
    <value encoded="n"><![CDATA[dunes://service.dunes.ch/CustomSDKObject?id='b9c69cb3-e162-4919-be78-4fe8347bc925'&dunesName='vCAC:VCACHost']]></value>
  </attrib>
  <attrib name="servers" type="Array/string" read-only="false">
    <value encoded="n"><![CDATA[#{#string#ucpadmin01233#;#string#ucpadmin01222#}#]]></value>
  </attrib>
  <workflow-item name="item0" type="end" end-mode="0">
    <position y="45.40909090909091" x="544.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item0" type="task">
    <display-name><![CDATA[Scriptable task]]></display-name>
    <script encoded="false"><![CDATA[System.log("Servers Selected = "+servers);
var vcacVm;
var propertyName = "ucp.tag.environment";
var propertyValue = "Production";
var vcacServerOut = new Array();

for each (server in servers){
	System.log("Servername = "+server);
	vcacVm = Server.findAllForType("vCAC:VirtualMachine", "VirtualMachineName eq '" +server+"'");
	System.log(vcacVm);
		var environment = System.getModule("com.vmware.library.vcac").getPropertyFromVirtualMachine(host,vcacVm,propertyName);
		if (environment = propertyValue){
				vcacServerOut.push(vcacVm);
			}
		}
System.log(vcacServerOut);

]]></script>
    <in-binding>
      <bind name="host" type="vCAC:VCACHost" export-name="host"/>
      <bind name="servers" type="Array/string" export-name="servers"/>
    </in-binding>
    <out-binding>
      <bind name="vcacServerOut" type="Array/vCAC:VirtualMachine" export-name="vcacServerOut"/>
    </out-binding>
    <position y="55.40909090909091" x="204.5"/>
  </workflow-item>
  <presentation/>
</workflow>