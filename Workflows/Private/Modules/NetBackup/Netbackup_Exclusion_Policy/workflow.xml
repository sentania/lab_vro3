<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="13f0908d-5700-4f6c-91c3-c96c4b7008c8" version="0.0.0" api-version="6.0.0" allowed-operations="vfe" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[Netbackup_Exclusion_Policy]]></display-name>
  <position y="50.0" x="100.0"/>
  <input>
    <param name="Server_Name" type="Array/string"/>
    <param name="Policy_Name" type="string"/>
    <param name="BG_Name" type="string"/>
  </input>
  <workflow-item name="item0" type="end" end-mode="0">
    <position y="45.40909090909091" x="384.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item0" type="task">
    <display-name><![CDATA[Scriptable task]]></display-name>
    <script encoded="false"><![CDATA[System.log( 'Requestor - ' + System.getContext() + "MY CONTEXT")
System.log( 'Requestor - ' + System.getContext().getParameter("__asd_requestedFor"))
BGEmail = System.getContext().getParameter("__asd_requestedFor")
if((BGEmail.toLowerCase()).match('-nm')){
TBGEmail = BGEmail.split("-")[0]
BGEmail= TBGEmail 
}
System.log(BGEmail + '  - Requestor ID')
System.log(BG_Name + '  - BG NAME')


for each( sName in Server_Name ){
System.log(sName)
System.log("Policy_name "+ Policy_Name)
System.log("BG_Name  "+BG_Name)
System.log("Req_name : " + BGEmail)

			var workflowToLaunch = Server.getWorkflowWithId("e29f1bd6-de49-400f-b64e-03d258ee7500");
			if (workflowToLaunch == null) {
				throw "Workflow not found";
			}
			var workflowParameters = new Properties();
			workflowParameters.put("Server_Name",sName);
			workflowParameters.put("Policy_Name",Policy_Name);
			workflowParameters.put("BGName",BG_Name);
			workflowParameters.put("Req_name",BGEmail);
			var wfToken = workflowToLaunch.execute(workflowParameters);
 }]]></script>
    <in-binding>
      <bind name="Server_Name" type="Array/string" export-name="Server_Name"/>
      <bind name="Policy_Name" type="string" export-name="Policy_Name"/>
      <bind name="BG_Name" type="string" export-name="BG_Name"/>
    </in-binding>
    <out-binding/>
    <position y="55.40909090909091" x="204.5"/>
  </workflow-item>
  <presentation>
    <p-param name="Server_Name">
      <desc><![CDATA[Server_Name]]></desc>
    </p-param>
    <p-param name="Policy_Name">
      <desc><![CDATA[Policy_Name]]></desc>
    </p-param>
    <p-param name="BG_Name">
      <desc><![CDATA[BG_Name]]></desc>
    </p-param>
  </presentation>
</workflow>