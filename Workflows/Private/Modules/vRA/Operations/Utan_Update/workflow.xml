<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="0d7fa39c-5d29-4dc5-bdeb-985fefdc333c" version="0.0.10" api-version="6.0.0" allowed-operations="vfe" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[Utan_Update]]></display-name>
  <position y="50.0" x="100.0"/>
  <input>
    <param name="UserUTAN" type="string"/>
    <param name="Server_name" type="VC:VirtualMachine"/>
  </input>
  <output>
    <param name="var" type="Array/CompositeType(statusCode:Number,contentLength:Number,headers:Properties,contentAsString:String)"/>
  </output>
  <attrib name="Key_Content" type="Array/string" read-only="false">
    <value encoded="n"><![CDATA[__NULL__]]></value>
  </attrib>
  <attrib name="Value_Content" type="Array/string" read-only="false">
    <value encoded="n"><![CDATA[__NULL__]]></value>
  </attrib>
  <workflow-item name="item0" type="end" end-mode="0">
    <position y="45.40909090909091" x="644.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item4" type="task">
    <display-name><![CDATA[Scriptable task]]></display-name>
    <script encoded="false"><![CDATA[System.log(System.getContext().getParameter("UUTAN"))
UTAN_Number = System.getContext().getParameter("UUTAN")
System.log("Server_name - " + Server_name)
System.log(UserUTAN)

if(UserUTAN == null){
	UserUTAN = System.getContext().getParameter("UTANAppName")
 }
if(UTAN_Number == null){
	UTAN_Number = System.getContext().getParameter("UTANNumber")
 }

VM_Server = Server_name.name
System.log("Updating UTAN for Server " + VM_Server + " with " + UserUTAN)
Key_Content = []
Value_Content =[]
Key_Content.push("unifiedcompute/servers/"+ VM_Server + "/utanName")
Value_Content.push(encodeURI(UserUTAN))
System.log("Key to be passed - "+ Key_Content)
System.log("Value to be Passed  - "+ Value_Content)

Key_Content.push("unifiedcompute/servers/"+ VM_Server + "/utanNumber")
Value_Content.push(UTAN_Number)
//var VM = hostvc.getAllVirtualMachines(null, "xpath:contains(name, '" + Server_name + "')");
System.getModule("com.vmware.library.vc.customattribute").setOrCreateCustomField(Server_name,'utanName',UserUTAN);
System.getModule("com.vmware.library.vc.customattribute").setOrCreateCustomField(Server_name, 'utanNumber',UTAN_Number );


var utan = "ucp.utan";
var utanname  = "ucp.utan_name"
vcacHost = Server.findAllForType("vCAC:VCACHost")[0];
vCACVms = Server.findAllForType("vCAC:VirtualMachine", "VirtualMachineName eq '" + VM_Server + "'");
virtualMachineEntity =  vCACVms[0].getEntity();
System.getModule("com.nm.ucp").addUpdatePropertyFromVirtualMachineEntity(vcacHost, utan, UTAN_Number, false, false, false, false, vCACVms[0]) ;
System.getModule("com.nm.ucp").addUpdatePropertyFromVirtualMachineEntity(vcacHost, utanname, UserUTAN, false, false, false, false, vCACVms[0])	







]]></script>
    <in-binding>
      <bind name="UserUTAN" type="string" export-name="UserUTAN"/>
      <bind name="Server_name" type="VC:VirtualMachine" export-name="Server_name"/>
    </in-binding>
    <out-binding>
      <bind name="Key_Content" type="Array/string" export-name="Key_Content"/>
      <bind name="Value_Content" type="Array/string" export-name="Value_Content"/>
    </out-binding>
    <position y="55.40909090909091" x="204.5"/>
  </workflow-item>
  <workflow-item name="item4" out-name="item0" type="foreach">
    <display-name><![CDATA[Foreach (etcd - Add Key)]]></display-name>
    <in-binding>
      <bind name="key" type="Array/string" export-name="*Key_Content">
        <description><![CDATA[etcd key to update]]></description>
      </bind>
      <bind name="value" type="Array/string" export-name="*Value_Content">
        <description><![CDATA[value of the key]]></description>
      </bind>
    </in-binding>
    <out-binding>
      <bind name="statusCode" type="Array/Number" export-name="*var.statusCode"/>
      <bind name="contentLength" type="Array/Number" export-name="*var.contentLength"/>
      <bind name="headers" type="Array/Properties" export-name="*var.headers"/>
      <bind name="contentAsString" type="Array/String" export-name="*var.contentAsString"/>
    </out-binding>
    <reference type="Workflow" id="1fa52ce3-f6c0-43f8-a28f-6790c2e93f13"/>
    <description><![CDATA[Autogenerated workflow.]]></description>
    <position y="55.40909090909091" x="324.5"/>
  </workflow-item>
  <presentation>
    <p-param name="UserUTAN">
      <desc><![CDATA[UserUTAN]]></desc>
    </p-param>
    <p-param name="Server_name">
      <desc><![CDATA[Server_name]]></desc>
    </p-param>
  </presentation>
</workflow>