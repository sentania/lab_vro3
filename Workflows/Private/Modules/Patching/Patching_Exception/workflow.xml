<?xml version='1.0' encoding='UTF-8'?>
<workflow xmlns="http://vmware.com/vco/workflow" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://vmware.com/vco/workflow http://vmware.com/vco/workflow/Workflow-v4.xsd" root-name="item1" object-name="workflow:name=generic" id="8a2b9989-f642-4ee8-8b35-9e17946e627e" version="0.0.9" api-version="6.0.0" allowed-operations="vfe" restartMode="1" resumeFromFailedMode="0">
  <display-name><![CDATA[Patching_Exception]]></display-name>
  <position y="50.0" x="100.0"/>
  <input>
    <param name="Server_Name" type="Array/string"/>
    <param name="Patch_Wave" type="string"/>
    <param name="BG_Name" type="string"/>
  </input>
  <attrib name="Key_Content" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="Value_content" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="BGEmail" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <attrib name="Business_group" type="string" read-only="false">
    <value encoded="n"><![CDATA[]]></value>
  </attrib>
  <workflow-item name="item0" type="end" end-mode="0">
    <position y="45.40909090909091" x="384.5"/>
  </workflow-item>
  <workflow-item name="item1" out-name="item0" type="task">
    <display-name><![CDATA[Scriptable task]]></display-name>
    <script encoded="false"><![CDATA[System.log( 'Requestor - ' + System.getContext() + "MY CONTEXT")
System.log( 'Requestor - ' + System.getContext().getParameter("__asd_requestedFor"))
BGEmail = System.getContext().getParameter("__asd_requestedFor")
if((BGEmail.toLowerCase()).match('-nm')){
TBGEmail = BGEmail.split("-")[0]
BGEmail= TBGEmail 
}
System.log(BGEmail + '  - Requestor ID')
System.log(BG_Name + '  - BG NAME')


for each( sName in Server_Name ){
System.log(sName)
System.log(Patch_Wave)
			//var workflowToLaunch = Server.getWorkflowWithId("6b5ec590-ee10-47fe-8ba0-4afbb1183e5a");
  			  var workflowToLaunch = Server.getWorkflowWithId("4f631916-c172-43ac-852d-eac92855d4e2")
			if (workflowToLaunch == null) {
				throw "Workflow not found";
			}
			var workflowParameters = new Properties();
			workflowParameters.put("Server_Name",sName);
			workflowParameters.put("Patch_Wave",Patch_Wave);
			workflowParameters.put("BGEmail",BGEmail);
			workflowParameters.put("BG_Name",BG_Name);
			var wfToken = workflowToLaunch.execute(workflowParameters);
 }]]></script>
    <in-binding>
      <bind name="Server_Name" type="Array/string" export-name="Server_Name"/>
      <bind name="Patch_Wave" type="string" export-name="Patch_Wave"/>
      <bind name="BG_Name" type="string" export-name="BG_Name"/>
    </in-binding>
    <out-binding>
      <bind name="BGEmail" type="string" export-name="BGEmail"/>
      <bind name="Business_group" type="string" export-name="Business_group"/>
    </out-binding>
    <position y="55.40909090909091" x="204.5"/>
  </workflow-item>
  <presentation>
    <p-param name="Server_Name">
      <desc><![CDATA[Server_Name]]></desc>
    </p-param>
    <p-param name="Patch_Wave">
      <desc><![CDATA[Patch_Wave]]></desc>
    </p-param>
    <p-param name="BG_Name">
      <desc><![CDATA[BG_Name]]></desc>
    </p-param>
  </presentation>
</workflow>